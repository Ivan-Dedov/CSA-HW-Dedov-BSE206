# Домашнее задание №2
Дедов Иван Николаевич, БПИ-206

## Описание полученного задания

### Номер варианта
208

### Номер условия
(208 - 1) % 14 + 1 = 12

### Номер дополнительной функции
((208 - 1) / 14) % 25 + 1 = 15

### Полученное условие
| Обобщенный артефакт, используемый в задании | Базовые альтернативы | Общие для всех альтернатив переменные | Общие для всех альтернатив функции | Обработка данных |
| - | - | - | - | - |
| Животные | 1. Рыбы (место проживания – перечислимый тип: река, море, озеро...) <br/> 2. Птицы (отношение к перелету: перелетные, остающиеся на зимовку – булевская величина) <br/> 3. Звери (хищники, травоядные, насекомоядные... – перечислимый тип) | 1. Название – строка символов, <br/> 2. Вес в граммах (целое) | Частное от деления суммы кодов незашифрованной строки на число символов в этой строке на вес (действительное число) | Упорядочить элементы контейнера по убыванию используя сортировку с помощью «дерева» (Heap Sort). В качестве ключей для сортировки и других действий используются результаты функции, общей для всех альтернатив. |

## Структурная схема изучаемой архитектуры ВС с размещенной на ней разработанной программой

### Таблица типов
| Тип данных | Занимаемая память (в байтах) \[индекс в памяти\] |
| - | - |
| int | 4 |
| char | 1 |
| string | 28 |
| **class Creature** { <br/>&nbsp;&nbsp;&nbsp;&nbsp;name_: std::string<br/>&nbsp;&nbsp;&nbsp;&nbsp;weight_: int<br/> } | 24 \[0\]<br/>4 \[24\]<br/> |
| **class Animal : public Creature** { <br/>&nbsp;&nbsp;&nbsp;&nbsp;name_: std::string<br/>&nbsp;&nbsp;&nbsp;&nbsp;weight_: int<br/>&nbsp;&nbsp;&nbsp;&nbsp;foodSource_ : enum FoodSource<br/>&nbsp;&nbsp;&nbsp;&nbsp;food_source_names_: static const char\*\[\] <br/> } | 24 \[0\]<br/>4 \[24\]<br/>4 \[28\]<br/><br/> |
| **class Bird : public Creature** { <br/>&nbsp;&nbsp;&nbsp;&nbsp;name_: std::string<br/>&nbsp;&nbsp;&nbsp;&nbsp;weight_: int<br/>&nbsp;&nbsp;&nbsp;&nbsp;doesMigrate_ : bool<br/> } | 24 \[0\]<br/>4 \[24\]<br/>1 \[28\]<br/><br/> |
| **class Fish : public Creature** { <br/>&nbsp;&nbsp;&nbsp;&nbsp;name_: std::string<br/>&nbsp;&nbsp;&nbsp;&nbsp;weight_: int<br/>&nbsp;&nbsp;&nbsp;&nbsp;habitat_ : enum Habitat<br/>&nbsp;&nbsp;&nbsp;&nbsp;food_source_names_: static const char\*\[\] <br/> } | 24 \[0\]<br/>4 \[24\]<br/>4 \[28\]<br/><br/> |
| **class CreatureArray** { <br/>&nbsp;&nbsp;&nbsp;&nbsp;data_: Creature\*\*<br/>&nbsp;&nbsp;&nbsp;&nbsp;size_: int <br/>&nbsp;&nbsp;&nbsp;&nbsp;kMaxSize: static const int <br/> } | 4 \[0\] <br/> 4 \[4\] <br/> 4 \[8\] <br/> |

Экземпляры классов **Animal**, **Bird** и **Fish** хранятся в куче и занимают 40 байт.

### Глобальная память
Не используется.

### Память программы

#### Детальная память методов

##### ```int main(int argc, char **argv)```

| Переменная | Занимаемая память (в байтах) \[индекс в памяти\] |
| - | - |
| argc: int | 4 \[0\] |
| argv: char** | 8 \[4\] |
| creatures: CreatureArray | 12 \[12\] |
| number_of_elements: int | 4 \[24\] |

| Информация в куче |
| - |
| "-f" |
| "input.txt" |
| "output.txt" |
| creatures (экземпляр класса **CreatureArray**) |
| Элементы, хранящиеся в массиве **data_** экземпляра класса **CreatureArray** |

##### ```void CreatureArray::fillFromFile(char *filename)```

| Переменная | Занимаемая память (в байтах) \[индекс в памяти\] |
| - | - |
| filename: char* | 4 \[0\] |
| input_file: std::ifstream | 184 \[4\] |
| creature_name: std::string | 28 \[188\] |
| weight: int | 4 \[216\] |
| creature_type: int | 4 \[220\] |
| additional_parameter: int | 4 \[224\] |
| index: int | 4 \[228\] |

| Информация в куче |
| - |
| Элементы, создающиеся внутри условного блока и присваивающиеся значениям массива **data_** экземпляра класса **CreatureArray** |

##### ```void CreatureArray::generateRandomly(int count)```

| Переменная | Занимаемая память (в байтах) \[индекс в памяти\] |
| - | - |
| count: int | 4 \[0\] |
| min: int | 4 \[4\] |
| rd: std::random_device | 1 \[8\] |
| gen: std::mt19937 | 5000 \[9\] |

| Информация в куче |
| - |
| Животные, создающиеся в результате вызова метода ```generateCreature``` |

##### ```Creature *generateCreature(int index, std::mt19937 *gen)```

| Переменная | Занимаемая память (в байтах) \[индекс в памяти\] |
| - | - |
| creature_type_generator: std::uniform_int_distribution | 8 \[0\] |
| weight_generator: std::uniform_int_distribution | 8 \[8\] |
| food_source_generator: std::uniform_int_distribution | 8 \[16\] |
| does_migrate_generator: std::uniform_int_distribution | 8 \[24\] |
| habitat_generator: std::uniform_int_distribution | 8 \[32\] |
| creature_type: int | 4 \[40\] |
| name: std::string | 28 \[44\] |
| weight: int | 4 \[72\] |
| animal: Animal\* <sup>i</sup> | 4 \[76\] |
| bird: Bird\* <sup>i</sup> | 4 \[76\] |
| fish: Fish\* <sup>i</sup> | 4 \[76\] |

<sup>i</sup> Создается только один из экземпляров животного. Все зависит от числа, сгенерированного в ```creature_type_generator```.

| Информация в куче |
| - |
| Экземпляры классов **Animal**, **Bird** и **Fish** |

#### Стек вызовов

Описан в виде дерева, так как вызов некоторых функций зависит от выполнения условий. Если вызов метода зависит от выполнения условия, то оба варианта сгруппированы (например, ```creatures.fillFromFile``` и ```creatures.generateRandomly```).

```
main 
│
│
├───creatures.fillFromFile
├───creatures.generateRandomly
│   └───creatures.generateCreature
│       └───creatures.generateName
│
│
├───creatures.printToStd
│   └───creature.toString
│
│
├───creatures.printToFile
│   └───creature.toString
│
│
├───creatures.heapSortDescending
│   ├───creatures.heapify
│   │   ├───creatures.swap
│   │   └───creatures.heapify*
│   │
│   ├───creatures.swap
│   └───creatures.heapify*
│
│
├───creatures.printToStd
│   └───creature.toString
│
│
└───creatures.printToFile
    └───creature.toString
```

\* Функция вызывается рекурсивно. Количество вызовов определяется at runtime.

## Требуемые метрики, определяющие характеристики программы, для различных тестовых прогонов

### Число интерфейсных модулей (заголовочных файлов)
7

### Число модулей реализации (файлов с определением программных объектов)
6

### Общий размер исходных текстов
| Файл                    | Размер                     |
| ----------------------- | -------------------------- |
| ```Animal.h```          | 951 байт                   |
| ```Animal.cpp```        | 585 байт                   |
| ```Bird.h```            | 670 байт                   |
| ```Bird.cpp```          | 530 байт                   |
| ```Creature.h```        | 2 111 байт                 |
| ```Creature.cpp```      | 689 байт                   |
| ```CreatureArray.h```   | 2 169 байт                 |
| ```CreatureArray.cpp``` | 5 645 байт                 |
| ```Fish.h```            | 876 байт                   |
| ```Fish.cpp```          | 482 байт                   |
| ```FoodSource.h```      | 249 байт                   |
| ```Habitat.h```         | 195 байт                   |
| ```main.cpp```          | 2 051 байт                 |
| **Всего**               | **17 203 байт ≈ 16.80 Кб** |

### Полученный размер исполняемого кода (если он формируется)
135 680 байт = 132.5 Кб

### Время выполнения программы для различных тестовых наборов данных:
| Тестовый файл    | Время выполнения |
| ---------------- | ---------------- |
| ```test01.txt``` | 0.015 с          |
| ```test02.txt``` | 0.058 с          |
| ```test03.txt``` | 0.720 с          |
| ```test04.txt``` | \*               |
| ```test05.txt``` | 0.034 с          |
| ```test06.txt``` | 0.018 с          |
| ```test07.txt``` | \*               |
| ```test08.txt``` | \*               |
| ```test09.txt``` | \*               |
| ```test10.txt``` | 0.155 с          |

\* В тесте введены некорректные данные. При нахождении первого некорректного набора программа тут же завершается.

## Данные, демонстрирующие сравнение с характеристиками ранее разработанных программ

Кардинально поменялась структура программы ввиду того, что используется другая парадигма программирования. Вместо одной структуры **Creature** появился базовый абстрактный класс **Creature** с несколькими определенными методами и несколькими виртуальными методами. У этого класса есть три класса-наследника, экземпляры которых мы можем создавать: **Animal**, **Bird** и **Fish**. В них явно указана реализация виртуальных методов.

В связи с такими изменениями, увеличилось количество файлов с исходным кодом, но самого кода стало меньше, так как появилось больше возможностей для использования одного и того же функционала (reusable code). Отсюда более маленький расход памяти на хранение файлов с кодом.

Однако количество времени, затраченное на каждый тест, увеличилось ввиду того, что вместо структур используются классы, хранящиеся в куче, а не на стеке (времязатраты на доступ к памяти). Также на время выполнения влияет использование потоков ввода-вывода (в отличие от **FILE** в **C**). Опять же, из-за использования классов, размер файла с исполняемым кодом вырос практически в 3 раза.

Стек вызовов программы изменился незначительно: вместо функций и процедур используются экземплярные методы классов. Некоторые методы были убраны в связи с отсутствием необходимости в них.
